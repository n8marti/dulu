<% duplicate_check = false unless defined? duplicate_check %>

<%= render 'shared/error_messages', errors: @person.errors %>

<%= form_for @person, html: {class: 'auto-width'} do |f| %>
  <div <%= "id='duplicate-check'".html_safe if duplicate_check %>>
    <div class="form-group">
      <%= f.label :first_name, t(:First_Name) %>
      <%= f.text_field :first_name, class: 'form-control title-cased', autofocus: true %>
    </div>

    <div class="form-group">
      <%= f.label :last_name, t(:Last_Name) %>
      <%= f.text_field :last_name, class: 'form-control title-cased' %>
    </div>

    <div id='duplicate-warning' class="bs-callout callout-red" style="display: none; margin-bottom: 12px;">
      <h4><span class="duplicate-name"></span> <%= t :already_exists %></h4>
      <p>
        <%= t :duplicate_warning_start %>
        <span class="duplicate-name"></span>
        <span class="duplicate-email"></span>
        <%= t :duplicate_warning_end %>
      </p>
      <div>
        <label>
          <%= check_box_tag :confirm_not_duplicate %>
          <%= t :confirm_different_person %>
        </label>
      </div>
    </div>
  </div>

  <div class="form-group">
    <label class="radio-inline">
      <%= f.radio_button :gender, "M", checked: true %>
      <%= t :Male %>
    </label>
    <label class="radio-inline">
      <%= f.radio_button :gender, "F" %>
      <%= t :Female %>
    </label>
  </div>

  <div class="form-group">
    <%= f.label :country, t(:Home_Country) %>
    <%= f.collection_select :country_id, Country.all_in_order, :id, :name,
                            {include_blank: true}, {class: 'form-control'}%>
  </div>

  <div class="form-group">
    <%= f.label :organization, t(:Organization) %>
    <%= f.collection_select :organization_id, Organization.all, :id, :name,
                            {include_blank: true}, {class: 'form-control'} %>
  </div>

  <div class="form-group">
    <%= f.label :email, t(:Email) %>
    <%= f.text_field :email, class: 'form-control' %>
  </div>

  <% if can? :grant_login, Person %>
    <div class="form-group">
      <label>
        <%= f.check_box :has_login %>
        <%= t :Can_log_in %>
      </label>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :ui_language, t(:dulu_preferred_language) %><br>
    <label class="radio-inline">
      <%= f.radio_button :ui_language, "en", checked: true %>
      <%= t :English %>
    </label>
    <label class="radio-inline">
      <%= f.radio_button :ui_language, "fr" %>
      <%= t :French %>
    </label>
  </div>

  <div class="form-group">
    <%= f.label :email_pref, t(:Email_frequency) %><br />
    <% Person.email_prefs.keys.each do |pref| %>
      <label class="radio-inline">
        <%= f.radio_button :email_pref, pref %>
        <%= t pref %>
      </label>
    <% end %>
  </div>

  <p>
    <%= f.submit t(:Save), class: 'btn btn-primary btn-lg' %>
    <a onclick="window.history.back()" class="btn btn-lg btn-danger"><%= t :Cancel %></a>
  </p>
<% end %>

<% if @person.persisted? and can?(:destroy, @person) %>
  <p>--</p>
  <p>
    <%= button_to "#{t(:Delete)} #{@person.full_name}",
                  @person,
                  method: :delete,
                  data: {confirm: t(:Delete_person_confirmation, person: @person.full_name)},
                  class: 'btn btn-danger' %>
  </p>
<% end %>